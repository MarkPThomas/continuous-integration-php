# Config file for https://travis-ci.org/
# Validate this file here - http://lint.travis-ci.org/

language: php

# Define the php versions against we want to test our code
php:
    - 7.0

#env:
#  - secure: 6NQVYZhz5skozeomCDyg0iJCXg5zvIIYTqXiZsqXVHGPsQYqUPHBiTtKjO8rMvtKwTzdv1uS1oHpKme53y+D7g==
#  - COVERALLS_REPO_TOKEN:
#    - secure: HhoM35ArQ+WQkdZxQIo+19QHoAPRBTiEO1vw78i/naSaJ9EGTMYD1MKJQZRJiOvj


#  COVERALLS_RUN_LOCALLY=1
#  COVERALLS_REPO_TOKEN=paA4WjNDLj9DiIHDvWJ6GDF2QON8VUNuc
#  COVERALLS_REPO_TOKEN: paA4WjNDLj9DiIHDvWJ6GDF2QON8VUNuc

# Note: Code coverage requires php-xDebug extension enabled on CI server
#before_install:
#  - composer require phpunit/phpunit:4.8.* satooshi/php-coveralls:dev-master
#  - composer require satooshi/php-coveralls:dev-master
#  - composer install --dev

install:
  # Install composer packages
  - composer install --prefer-dist --no-interaction --no-progress

# Create a storage folder for coverage report
before_script:
  - mkdir -p build/logs
  - ls -al

# Testing the app (see phpunit.xml) for configs, generating Code Coverage report
script:
  - ./vendor/bin/phpunit --coverage-clover ./build/logs/clover.xml

after_script:
  - export CI_BUILD_NUMBER="$TRAVIS_BUILD_NUMBER"
  - export CI_PULL_REQUEST="$TRAVIS_PULL_REQUEST"
  - export CI_BRANCH="$TRAVIS_BRANCH"
  - php vendor/bin/coveralls -v

# Tell Travis CI to monitor only 'master' branch
branches:
  only: master

# You can delete the cache using travis-ci web interface
cache:
  directories:
  - vendor
  - $HOME/.cache/composer