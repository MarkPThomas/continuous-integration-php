# Config file for https://travis-ci.org/
# Validate this file here - http://lint.travis-ci.org/
dist: trusty
sudo: required

language: php

# Define the php versions against we want to test our code
php:
    - 7.0

env:
  - COVERALLS_RUN_LOCALLY=1
  # - secure: ######  # Specified as COVERALLS_REPO_TOKEN in Repository Settings w/o encryption
  #
  # Otherwise, try
  # The key encryption of'COVERALLS_RUN_LOCALLY=xxx' at https://ci.appveyor.com/tools/encrypt
  # Or try using: https://travis-encrypt.github.io/
  # (see https://github.com/travis-ci/travis-ci/issues/9510)

addons:
  sonarcloud:
    organization: "markpthomas-github"
    token: $SONAR_TOKEN
#      secure: $SONAR_TOKEN  # Specified as SONAR_TOKEN in Repository Settings w/o encryption

install:
  # Install composer packages
  - composer install --prefer-dist --no-interaction --no-progress

# Create a storage folder for coverage report
before_script:
  - mkdir -p build/logs
  - ls -al

# Testing the app (see phpunit.xml) for configs, generating Code Coverage report
script:
  - ./vendor/bin/phpunit --coverage-clover ./build/logs/clover.xml
  - sonar-scanner -X

after_script:
  - php vendor/bin/coveralls -v

# Tell Travis CI to monitor only 'master' branch
branches:
  only: master

# You can delete the cache using travis-ci web interface
cache:
  directories:
    - 'vendor'
    - '$HOME/.cache/composer'
    - '$HOME/.sonar/cache'